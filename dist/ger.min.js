!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.GER=t()}(this,function(){function e(e,t){return f?e:t}function t(e,t,r){return e.apply(r,t)}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},a={typeDecide:function(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"},isFunction:function(e){return a.typeDecide(e,"Function")},isString:function(e){return a.typeDecide(e,"String")},serializeObj:function(e){var t="";return Object.keys(e).forEach(function(r){t+=a.typeDecide(e[r],"Object")?r+"="+a.stringify(e[r]):r+"="+e[r]+"^"}),console.log(t),encodeURIComponent(t.substr(0,t.length-1))},stringify:function(e){if(window.JSON&&window.JSON.stringify)return JSON.stringify(e);var t="undefined"==typeof e?"undefined":r(e);if("object"!=t||null===e)return"string"==t&&(e='"'+e+'"'),String(e);var n,o,i=[],u=e&&e.constructor==Array,a=arguments.callee;for(n in e)e.hasOwnProperty(n)&&(o=e[n],t="undefined"==typeof o?"undefined":r(o),e.hasOwnProperty(n)&&("string"==t?o='"'+o+'"':"object"==t&&null!==o&&(o=a(o)),i.push((u?"":'"'+n+'":')+String(o))));return(u?"[":"{")+String(i)+(u?"]":"}")},parse:function(e){return window.JSON&&window.JSON.parse?JSON.parse(e):new Function("return "+e)()},getServerPort:function(){return""===window.location.port?"http:"===window.location.protocol?"80":"443":window.location.port},getUserAgent:function(){return window.navigator.userAgent},getPlatType:function(){try{return document.createEvent("TouchEvent"),"Mobile"}catch(e){return"PC"}},flashVer:function(){var e="-",t=navigator,r=void 0;if(t.plugins&&t.plugins.length){for(r=0;r<t.plugins.length;r++)if(t.plugins[r].name.indexOf("Shockwave Flash")!==-1){e=t.plugins[r].description.split("Shockwave Flash ")[1];break}}else if(window.ActiveXObject)for(r=10;r>=2;r--)try{var n=new Function("return new ActiveXObject('ShockwaveFlash.ShockwaveFlash."+r+"');")();if(n){e=r+".0";break}}catch(e){}return e},stringSplice:function(e,t,r,n){if(""===e)return"";n=""===n?"=":n,t+=n;var o=e.indexOf(t);if(o<0)return"";o+=t.length;var i=i<o?e.length:e.indexOf(r,o);return e.substring(o,i)},getReferer:function(){var e=document.referrer.toLowerCase(),t=/^[^\?&#]*.swf([\?#])?/;return""!==e&&!e.match(t)||(e=a.stringSplice(window.location.href,"ref","&",""),""===e)?encodeURIComponent(e):encodeURIComponent(e)},getSystemParams:function(){var e=window.screen;return{userAgent:a.getUserAgent(),currentUrl:window.location.href,timestamp:+new Date+Math.random(),projectType:a.getPlatType(),flashVer:a.flashVer(),title:document.title,screenSize:e.width+"x"+e.height,referer:location.hostname?location.hostname:"",host:window.location.protocol+"//"+window.location.hostname}},toArray:function(e){return Array.prototype.slice.call(e)},getCookie:function(e){for(var t=document.cookie.split("; "),r="",n=0;n<t.length;n++){var o=t[n].split("=");if(o[0]==e){r=o[1];break}}return r},addCookie:function(e,t,r){var n=new Date;return n.setDate(n.getDate()+(r||365)),document.cookie=e+"="+t+"; expires="+n.toGMTString(),a.getCookie(e)},noop:function(){},clearCookie:function(e){return a.addCookie(e,"",-1),a.getCookie(e)},assignObject:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}},c=function(e){return function(e){function t(e){n(this,t);var r=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handlers={},r}return i(t,e),o(t,[{key:"on",value:function(e,t){return this.handlers[e]=this.handlers[e]||[],this.handlers[e].push(t),this.handlers[e]}},{key:"off",value:function(e){this.handlers[e]&&delete this.handlers[e]}},{key:"trigger",value:function(e,t){var r=this,n=t||[],o=this.handlers[e];return!o||o.every(function(e){var t=e.apply(r,n);return t!==!1})}}]),t}(e)},s=function(){function e(t){n(this,e),this.config={proxyAll:!1,mergeReport:!0,delay:1e3,url:"ewewe",except:[/^Script error\.?/,/^Javascript error: Script error\.? on line 0/],random:1,repeat:5,errorLSSign:"mx-error",maxErrorCookieNo:20,validTime:7},this.config=a.assignObject(this.config,t)}return o(e,[{key:"get",value:function(e){return this.config[e]}},{key:"set",value:function(e,t){return this.config[e]=t,this.config[e]}}]),e}(),f=!!window.localStorage,l={getKey:function(e){var t=function(t){return e[t]};return["msg","colNum","rowNum"].filter(t).map(t).join("@")},deleteExpiresItem:function(e){var t=e?a.parse(e):{},r=+new Date;for(var n in t)t[n].expiresTime<=r&&delete t[n];return t},getEpires:function(e){return+new Date+864e5*e},limitError:function(e,t){var r=Object.keys(e);return r.length>=t&&delete e[r[0]],e},setInfo:function(e,t,r,n){var o=l.getItem(e);if(t){var i=l.getKey(t);o=this.limitError(o,n),o[i]={expiresTime:l.getEpires(r),value:t.msg}}return a.stringify(o)},setItem:e(function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];localStorage.setItem(r[0],t(l.setInfo,r,l))},function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];a.addCookie(r[0],t(l.setInfo,r,l))}),getItem:e(function(e){return l.deleteExpiresItem(localStorage.getItem(e))},function(e){return l.deleteExpiresItem(a.getCookie(e))}),clear:e(function(e){return e?localStorage.removeItem(e):localStorage.clear()},function(e){return e?a.clearCookie(e):document.cookie.split("; ").forEach(a.clearCookie)})},p=function(e){return function(e){function t(e){n(this,t);var r=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.setItem(),r}return i(t,e),o(t,[{key:"getItem",value:function(e){return l.getItem(e)}},{key:"setItem",value:function(e){var t=this.config;return l.setItem(this.config.errorLSSign,e,t.validTime,t.maxErrorCookieNo),a.stringify(e)}},{key:"clear",value:function(e){l.clear(e)}}]),t}(e)},h=function(e){return function(e){function t(e){n(this,t);var r=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.errorQueue=[],r.repeatList={},r.url=r.config.url,["log","debug","info","warn","error"].forEach(function(e,t){r[e]=function(n){return r.handleMsg(n,e,t)}}),r}return i(t,e),o(t,[{key:"repeat",value:function(e){var t=e.rowNum||"",r=e.colNum||"",n=e.msg+t+r;return this.repeatList[n]=this.repeatList[n]?this.repeatList[n]+1:1,this.repeatList[n]>this.config.repeat}},{key:"request",value:function(e,t){var r=new window.Image;r.onload=t,r.src=e}},{key:"report",value:function(e){var t=this,r=this.config.mergeReport,n=this.errorQueue,o=r?n:[n.shift()],i=o.map(function(e){return t.setItem(e),a.serializeObj(e)}).join("|");return this.url+=i,this.request(this.url,function(){r&&(n=[]),e&&e.call(t),t.trigger("afterReport")}),this.url}},{key:"send",value:function(e){var t=this;if(this.trigger("beforeReport")){var r=e||a.noop,n=this.config.mergeReport?this.config.delay:0;setTimeout(function(){t.report(r)},n)}}},{key:"except",value:function(e){var t=this.config.except,r=!1,n=null;if(a.typeDecide(t,"Array"))for(var o=0,i=t.length;o<i;o++)if(n=t[o],a.typeDecide(n,"RegExp")&&n.test(e.msg)||a.typeDecide(n,"Function")&&n(e,e.msg)){r=!0;break}return r}},{key:"catchError",value:function(e){var t=Math.random();return!(t>=this.config.random)&&(!this.repeat(e)&&(!this.except(e)&&(this.errorQueue.push(e),this.errorQueue)))}},{key:"handleMsg",value:function(e,t,r){if(!e)return!1;if(a.typeDecide(e,"Object")&&!e.msg)return!1;a.typeDecide(e,"Error")&&(e={msg:e.message,ext:{stack:e.stack}});var n=a.typeDecide(e,"Object")?e:{msg:e,level:r};return n=a.assignObject(a.getSystemParams(),n),this.catchError(n)&&this.send(),n}}]),t}(e)},y=function(e){return function(e){function t(e){n(this,t);var r=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.consoleList={},r.timeoutkey=null,r.proxy(),r}return i(t,e),o(t,[{key:"proxy",value:function(){var e=this.config;e.proxyAll?this.proxyJquery().proxyModules().proxyTimer().proxyConsole():(e.proxyJquery&&this.proxyJquery(),e.proxyModules&&this.proxyModules(),e.proxyTimer&&this.proxyTimer(),e.proxyConsole&&this.proxyConsole())}},{key:"proxyConsole",value:function(){var e=this;return["log","debug","info","warn","error"].forEach(function(t,r){var n=window.console[t];window.console[t]=function(){for(var o=arguments.length,i=Array(o),u=0;u<o;u++)i[u]=arguments[u];e.reportConsole(n,t,r,a.toArray(i))}}),this}},{key:"proxyTimer",value:function(){return window.setTimeout=this.catTimeout(setTimeout),window.setInterval=this.catTimeout(setInterval),this}},{key:"proxyJquery",value:function(e){var t=this,r=e||window.$;if(!r||!r.event)return this;var n=void 0,o=void 0;r.zepto?(n=r.fn.on,o=r.fn.off,r.fn.on=this.makeArgsTry(n),r.fn.off=function(){var e=[];return a.toArray(arguments).forEach(function(t){a.isFunction(t)&&t.tryWrap&&(t=t.tryWrap),e.push(t)}),o.apply(this,e)}):r.fn.jquery&&(n=r.event.add,o=r.event.remove,r.event.add=this.makeArgsTry(n),r.event.remove=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=[];return a.toArray(r).forEach(function(e){a.typeDecide(e,"Function")&&e.tryWrap&&(e=e.tryWrap),i.push(e)}),o.apply(t,i)});var i=r.ajax;return i&&(r.ajax=function(e,n){return n||(n=e,e=void 0),t.makeObjTry(n),e?i.call(r,e,n):i.call(r,n)}),this}},{key:"reportConsole",value:function(e,t,r,n){var o=this;this.on("beforeReport",function(){o.config.mergeReport=!0});var i="";n.forEach(function(e){i+=a.typeDecide(e,"string")?e:a.typeDecide(e,"array")?"["+e.join(",")+"]":a.stringify(e)});var u=this.consoleList[t];return u=u||[],u.push(a.assignObject(a.getSystemParams(),{msg:i,level:r,rowNum:"",colNum:"",targetUrl:""})),u.length>10&&(this.errorQueue=this.errorQueue.concat(u),this.send(!0,function(){u=[]})),e.apply(this,n)}},{key:"proxyModules",value:function(){var e=window.require,t=window.define;if(t&&t.amd&&e&&(window.require=this.catArgs(e),a.assignObject(window.require,e),window.define=this.catArgs(t),a.assignObject(window.define,t)),window.seajs&&t){var r=this;window.define=function(){for(var e,n=[],o=0,i=arguments.length;o<i;o++)e=arguments[o],a.isFunction(e)&&(e=r.cat(e),e.toString=function(e){return function(){return e.toString()}}(arguments[o])),n.push(e);return t.apply(this,n)},window.seajs.use=this.catArgs(window.seajs.use),a.assignObject(window.define,t)}return this}},{key:"proxyCustomFn",value:function(e){return this.cat(e)}},{key:"proxyCustomObj",value:function(e){return this.makeObjTry(e)}},{key:"cat",value:function(e,t){var r=this;return function(){for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];try{return t=t||a.toArray(o),e.apply(r,t)}catch(e){if(r.trigger("tryError",[e]),r.error(e),!r.timeoutkey){var u=window.onerror;window.onerror=a.noop,r.timeoutkey=setTimeout(function(){window.onerror=u,r.timeoutkey=null},50)}throw e}}}},{key:"catArgs",value:function(e){var t=this;return function(){for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];var i=[];return a.toArray(n).forEach(function(e){a.isFunction(e)&&(e=t.cat(e)),i.push(e)}),e.apply(window,i)}}},{key:"catTimeout",value:function(e){var t=this;return function(){for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];var i=a.toArray(n),u=i[0],c=i[1];if(a.isString(u))try{u=new Function(u)}catch(e){throw e}var s=i.splice(2);return u=t.cat(u,s.length&&s),e(u,c)}}},{key:"makeArgsTry",value:function(e,t){var r=this;return function(){var n,o=[];return a.toArray(arguments).forEach(function(e){a.isFunction(e)&&(n=r.cat(e))&&(e.tryWrap=n)&&(e=n),o.push(e)}),e.apply(t||this,o)}}},{key:"makeObjTry",value:function(e){var t=void 0,r=void 0;for(t in e)e.hasOwnProperty(t)&&(r=e[t],a.isFunction(r)&&(e[t]=this.cat(r)));return e}}]),t}(e)},g=function(e){function t(e){n(this,t);var r=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.rewriteError(),r}return i(t,e),o(t,[{key:"rewriteError",value:function(){var e=this,t=arguments,r=window.onerror||a.noop;window.onerror=function(n,o,i,u,c){if(u=u||window.event&&window.event.errorCharacter||0,!e.trigger("error",a.toArray(t)))return!1;var s=n;if(c&&c.stack)s=e.handleErrorStack(c);else{for(var f=[],l=t.callee.caller,p=3;l&&--p>0&&(f.push(l.toString()),l!==l.caller);)l=l.caller;f.length>0&&(s+="@"+f.join(","))}a.typeDecide(s,"Event")&&(s+=s.type?"--"+s.type+"--"+(s.target?s.target.tagName+"::"+s.target.src:""):""),s&&e.error({msg:s,rowNum:i,colNum:u,targetUrl:o,level:4}),r.call(null,n,o,i,u,c)}}},{key:"handleErrorStack",value:function(e){var t=e.stack,r=e.toString();return r?t.indexOf(r)===-1&&(t+="@"+r):t="",t}}]),t}(c(p(h(y(s)))));return g});
